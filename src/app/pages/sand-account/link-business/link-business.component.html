<app-page-header [pageHeaderInfo]="pageHeaderInfo"></app-page-header>
<ng-template #headerExtra>
  <div>
    <div>
      <img src="../../../../assets/images/API (1).png" alt="" />
    </div>
  </div>
</ng-template>
<ng-template #headerContent>
  <span class="ctx-desc">
    Here, you can link your business account to an existing digital currency
    account.
  </span>
</ng-template>
<div class="normal-table-wrap">
  <nz-card
    [nzBodyStyle]="{ 'padding-bottom': 0 }"
    [nzTitle]="'Query Accounts'"
    class="m-b-10"
  >
    <form nz-form nzLayout="vertical">
      <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24 }">
        <div
          nz-col
          [nzXXl]="8"
          [nzXl]="8"
          [nzLg]="12"
          [nzMd]="12"
          [nzSm]="24"
          [nzXs]="24"
        >
          <nz-form-item>
            <nz-form-label [nzFor]="">Business Account</nz-form-label>
            <nz-form-control>
              <input
                nz-input
                placeholder=""
                name="businessAccount"
                [(ngModel)]="searchParam.businessAccount"
              />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div
          nz-col
          [nzXXl]="8"
          [nzXl]="8"
          [nzLg]="12"
          [nzMd]="12"
          [nzSm]="24"
          [nzXs]="24"
        >
          <nz-form-item>
            <nz-form-label [nzFor]="">DID</nz-form-label>
            <nz-form-control>
              <input
                nz-input
                placeholder=""
                name="did"
                [(ngModel)]="searchParam.did"
              />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div
          nz-col
          [nzXXl]="8"
          [nzXl]="8"
          [nzLg]="24"
          [nzMd]="24"
          [nzSm]="24"
          [nzXs]="24"
          class="text-right"
        >
          <nz-form-item>
            <nz-form-label [nzNoColon]="true"></nz-form-label>
            <nz-form-control>
              <div nz-col [nzSpan]="24">
                <button nz-button [nzType]="'primary'" (click)="getDataList()">
                  Query
                </button>
                <a nz-button nzType="link" class="m-l-15" (click)="resetForm()"
                  >Reset</a
                >
              </div>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>
  </nz-card>

  <app-card-table-wrap
    [tableTitle]="'Binding List'"
    [isNormalTable]="true"
    (reload)="reloadTable()"
    [btnTpl]="tableBtns"
  >
    <app-ant-table
      (selectedChange)="selectedChecked($event)"
      (changePageSize)="changePageSize($event)"
      (changePageNum)="getDataList($event)"
      [tableConfig]="tableConfig"
      [tableData]="dataList"
    ></app-ant-table>
    <ng-template
      #currencyTypeTpl
      let-outBusinessAccountBindManageSearchsSubList="outBusinessAccountBindManageSearchsSubList"
    >
      <div
        class="merge-cell"
        *ngFor="
          let currency of outBusinessAccountBindManageSearchsSubList;
          index as i
        "
        [style]="{
          'border-top': i == 0 ? '0' : '1px solid #f0f0f0',
          height: 50 * currency.currencyAccountList.length + 'px',
          'line-height': 50 * currency.currencyAccountList.length + 'px',
          'padding-left': '16px'
        }"
      >
        <span>{{ currency.currencyType }}</span>
      </div>
    </ng-template>
    <ng-template
      #currencyAccountTpl
      let-outBusinessAccountBindManageSearchsSubList="outBusinessAccountBindManageSearchsSubList"
    >
      <div
        class="merge-cell"
        *ngFor="
          let currency of outBusinessAccountBindManageSearchsSubList;
          index as i
        "
      >
        <div
          *ngFor="let item of currency.currencyAccountList; index as index"
          [style]="{
            'border-top': index == 0 && i == 0 ? '0' : '1px solid #f0f0f0',
            height: '50px',
            'line-height': '50px',
            'padding-left': '16px'
          }"
        >
          <span>{{ item }}</span>
        </div>
      </div>
    </ng-template>
    <ng-template
      #operationTpl
      let-bindingId="bindingId"
      let-did="did"
      let-businessAccount="businessAccount"
    >
      <span
        class="operate-text"
        (click)="showModal('edit', bindingId, did, businessAccount)"
        >Edit</span
      >
      <nz-divider nzType="vertical"></nz-divider>
      <span class="operate-text" (click)="unbind(bindingId)">Unbind</span>
    </ng-template>
    <nz-modal
      [(nzVisible)]="isVisible"
      nzTitle="Account binding"
      (nzOnCancel)="handleCancel()"
      [nzWidth]="800"
      nzCentered="true"
    >
      <div *nzModalContent class="m-t-15">
        <p class="operate-text text-center m-b-30">
          To link your business account to an existing digital currency account,
          enter your business account and DID.
        </p>
        <form nz-form [formGroup]="validateForm">
          <nz-form-item>
            <nz-form-label [nzSm]="9" [nzXs]="24" [nzNoColon]="true" nzRequired
              >Business Account</nz-form-label
            >
            <nz-form-control
              [nzSm]="9"
              [nzXs]="24"
              nzHasFeedback
              nzValidatingTip="Validating..."
              [nzErrorTip]="businessAccount"
            >
              <input
                nz-input
                maxlength="50"
                formControlName="businessAccount"
              />
              <ng-template #businessAccount let-control>
                <ng-container *ngIf="control.hasError('required')"
                  >The Business Account is required</ng-container
                >
              </ng-template>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSm]="9" [nzXs]="24" [nzNoColon]="true" nzRequired
              >DID</nz-form-label
            >
            <nz-form-control
              [nzSm]="9"
              [nzXs]="24"
              nzHasFeedback
              nzValidatingTip="Validating..."
              [nzErrorTip]="did"
            >
              <input nz-input formControlName="did" />
              <ng-template #did let-control>
                <ng-container *ngIf="control.hasError('required')"
                  >The DID is required</ng-container
                >
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>
      <div *nzModalFooter>
        <button nz-button nzType="default" (click)="handleCancel()">
          Cancel
        </button>
        <button
          nz-button
          nzType="primary"
          [nzLoading]="isConfirmLoading"
          [disabled]="!validateForm.valid"
          (click)="handleOk()"
        >
          Confirm
        </button>
      </div>
    </nz-modal>
  </app-card-table-wrap>
</div>
<ng-template #tableBtns>
  <button
    nz-button
    nzType="primary"
    class="m-r-8"
    (click)="showModal('add', '', '', '')"
  >
    <i nz-icon nzType="plus"></i>
    Add
  </button>
</ng-template>
